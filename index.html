<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROF Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .nav-fixed { position: fixed; bottom: 0; width: 100%; max-width: 500px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-top: 1px solid #efefef; }
        .view { display: none; padding-bottom: 80px; }
        .view.active { display: block; }
        .post-img { border-radius: 12px; margin-top: 10px; width: 100%; max-height: 400px; object-cover: cover; }
        .story-ring { background: linear-gradient(45deg, #f09433, #dc2743, #bc1888); padding: 2px; border-radius: 50%; }
        .btn-fire { background: linear-gradient(90deg, #ff416c, #ff4b2b); transition: 0.3s; }
        .btn-fire:hover { opacity: 0.9; transform: scale(0.98); }
    </style>
</head>
<body class="bg-white flex justify-center min-h-screen">

    <div class="w-full max-w-[500px] bg-white min-h-screen shadow-2xl relative">
        
        <header class="sticky top-0 bg-white/80 backdrop-blur-md z-50 border-b p-4 flex justify-between items-center">
            <h1 class="text-3xl font-black italic tracking-tighter text-red-600">ROF</h1>
            <div id="top-auth">
                <button onclick="login()" id="loginBtn" class="bg-black text-white px-4 py-1.5 rounded-full text-xs font-bold">Giriş Yap</button>
            </div>
        </header>

        <section id="home" class="view active">
            <div class="flex gap-4 p-4 overflow-x-auto border-b">
                <div class="flex flex-col items-center min-w-[65px]">
                    <div class="story-ring"><img id="me-story" src="https://via.placeholder.com/60" class="w-14 h-14 rounded-full border-2 border-white"></div>
                    <span class="text-[10px] mt-1">Sen</span>
                </div>
            </div>

            <div id="share-box" class="p-4 border-b hidden">
                <div class="flex gap-3">
                    <img id="me-mini" src="" class="w-10 h-10 rounded-full">
                    <div class="flex-1">
                        <textarea id="postText" placeholder="Neler oluyor?" class="w-full border-none outline-none text-lg resize-none" rows="2"></textarea>
                        <input type="text" id="postImgUrl" placeholder="Görsel URL (İsteğe bağlı)" class="w-full text-xs bg-gray-100 p-2 rounded-lg mt-2 outline-none">
                        <div class="flex justify-end mt-3">
                            <button onclick="sendPost()" class="btn-fire text-white px-6 py-2 rounded-full font-bold text-sm shadow-md">ATEŞLE</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="feed-content" class="divide-y"></div>
        </section>

        <section id="explore" class="view">
            <div class="p-4">
                <div class="bg-gray-100 flex items-center p-3 rounded-2xl">
                    <i class="fa fa-search text-gray-400 mr-2"></i>
                    <input type="text" id="searchUser" placeholder="Keşfet'te ara..." class="bg-transparent border-none outline-none w-full">
                </div>
                <div class="grid grid-cols-3 gap-1 mt-4" id="explore-grid">
                    </div>
            </div>
        </section>

        <section id="profile" class="view">
            <div class="p-6 text-center border-b">
                <div class="relative inline-block">
                    <img id="pro-img" src="" class="w-24 h-24 rounded-full border-4 border-red-500 mx-auto">
                </div>
                <h2 id="pro-name" class="text-2xl font-black mt-3"></h2>
                <p id="pro-tag" class="text-gray-400 font-medium">@username</p>
                <div class="flex justify-center gap-8 my-6">
                    <div><b id="count-posts">0</b><br><span class="text-xs text-gray-500">Gönderi</span></div>
                    <div><b>2.4K</b><br><span class="text-xs text-gray-500">Takipçi</span></div>
                    <div><b>512</b><br><span class="text-xs text-gray-500">Takip</span></div>
                </div>
                <button onclick="logout()" class="w-full border py-2 rounded-xl font-bold text-sm hover:bg-gray-50">Çıkış Yap</button>
                <button onclick="deleteAccount()" class="text-[10px] text-gray-300 mt-10 uppercase tracking-widest block mx-auto underline">Hesabı ve Verileri Sil</button>
            </div>
        </section>

        <nav class="nav-fixed flex justify-around p-4 z-50">
            <button onclick="changeTab('home', this)" class="text-red-600"><i class="fa-solid fa-house text-2xl"></i></button>
            <button onclick="changeTab('explore', this)" class="text-gray-400"><i class="fa-solid fa-magnifying-glass text-2xl"></i></button>
            <button onclick="changeTab('profile', this)" class="text-gray-400"><i class="fa-solid fa-user text-2xl"></i></button>
        </nav>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, updateDoc, arrayUnion, arrayRemove, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCTHfXRbJaUcN0ng-ik0B-N4Ai8pnnKiIk",
            authDomain: "rate-of-fire-rof.firebaseapp.com",
            projectId: "rate-of-fire-rof",
            storageBucket: "rate-of-fire-rof.firebasestorage.app",
            messagingSenderId: "706117316470",
            appId: "1:706117316470:web:833f1abf5994f96c0b5457"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // AUTH KONTROLÜ
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('top-auth').innerHTML = `<img src="${user.photoURL}" class="w-8 h-8 rounded-full border">`;
                document.getElementById('share-box').classList.remove('hidden');
                document.getElementById('me-story').src = user.photoURL;
                document.getElementById('me-mini').src = user.photoURL;
                document.getElementById('pro-img').src = user.photoURL;
                document.getElementById('pro-name').innerText = user.displayName;
                document.getElementById('pro-tag').innerText = "@" + user.displayName.toLowerCase().replace(/\s/g, '');
                loadPosts();
            } else {
                document.getElementById('top-auth').innerHTML = `<button onclick="login()" class="bg-black text-white px-4 py-1.5 rounded-full text-xs font-bold">Giriş Yap</button>`;
                document.getElementById('share-box').classList.add('hidden');
                document.getElementById('feed-content').innerHTML = `<div class="p-10 text-center text-gray-400">Görmek için giriş yapmalısın.</div>`;
            }
        });

        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);

        // SEKMELER
        window.changeTab = (tabId, el) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-red-600', 'text-gray-400'));
            el.classList.replace('text-gray-400', 'text-red-600');
        };

        // GÖNDERİ ATMA
        window.sendPost = async () => {
            const txt = document.getElementById('postText').value;
            const img = document.getElementById('postImgUrl').value;
            if(!txt && !img) return;

            try {
                await addDoc(collection(db, "posts"), {
                    uid: auth.currentUser.uid,
                    author: auth.currentUser.displayName,
                    avatar: auth.currentUser.photoURL,
                    text: txt,
                    image: img || null,
                    likes: [],
                    time: serverTimestamp()
                });
                document.getElementById('postText').value = "";
                document.getElementById('postImgUrl').value = "";
            } catch (e) { alert("Hata: " + e.message); }
        };

        // AKIŞI YÜKLE
        function loadPosts() {
            const q = query(collection(db, "posts"), orderBy("time", "desc"));
            onSnapshot(q, (snapshot) => {
                const feed = document.getElementById('feed-content');
                const grid = document.getElementById('explore-grid');
                feed.innerHTML = "";
                grid.innerHTML = "";
                let myPosts = 0;

                snapshot.forEach(docSnap => {
                    const p = docSnap.data();
                    const id = docSnap.id;
                    const isLiked = p.likes.includes(auth.currentUser.uid);
                    if(p.uid === auth.currentUser.uid) myPosts++;

                    // Feed Tasarımı
                    feed.innerHTML += `
                        <div class="p-4">
                            <div class="flex gap-3">
                                <img src="${p.avatar}" class="w-10 h-10 rounded-full">
                                <div class="flex-1">
                                    <div class="flex justify-between items-center">
                                        <span class="font-bold text-sm">${p.author}</span>
                                        <i class="fa fa-ellipsis-h text-gray-300 text-xs"></i>
                                    </div>
                                    <p class="text-[15px] mt-1 text-gray-800 leading-relaxed">${p.text}</p>
                                    ${p.image ? `<img src="${p.image}" class="post-img shadow-sm border">` : ''}
                                    <div class="flex gap-6 mt-4 text-gray-500">
                                        <button onclick="handleLike('${id}', ${isLiked})" class="flex items-center gap-1.5 ${isLiked ? 'text-red-500' : ''}">
                                            <i class="fa-${isLiked ? 'solid' : 'regular'} fa-heart"></i>
                                            <span class="text-xs font-bold">${p.likes.length}</span>
                                        </button>
                                        <button class="flex items-center gap-1.5"><i class="fa-regular fa-comment"></i> <span class="text-xs font-bold">0</span></button>
                                        <button class="flex items-center gap-1.5"><i class="fa-solid fa-share-nodes"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    
                    // Keşfet Tasarımı (Resimli olanlar)
                    if(p.image) {
                        grid.innerHTML += `<img src="${p.image}" class="aspect-square object-cover w-full hover:opacity-80 cursor-pointer">`;
                    }
                });
                document.getElementById('count-posts').innerText = myPosts;
            });
        }

        window.handleLike = async (id, status) => {
            const ref = doc(db, "posts", id);
            await updateDoc(ref, { likes: status ? arrayRemove(auth.currentUser.uid) : arrayUnion(auth.currentUser.uid) });
        };

        window.deleteAccount = async () => {
            if(confirm("Tüm verilerin silinecek! Onaylıyor musun?")) {
                await deleteUser(auth.currentUser);
                location.reload();
            }
        };

    </script>
</body>
</html>

