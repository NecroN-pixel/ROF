<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROF - Rate of Fire</title>
    <script src="https://cdn.tailwindcss.com"></script> <style>
        .post-card { transition: transform 0.2s; }
        .post-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

<nav class="bg-white border-b sticky top-0 z-50 p-3 shadow-sm">
    <div class="max-w-2xl mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold text-red-600 tracking-tighter">ğŸ”¥ ROF</h1>
        <div id="auth-area">
            <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded-full font-bold text-sm">Google ile GiriÅŸ</button>
        </div>
        <div id="user-area" class="hidden flex items-center gap-3">
            <img id="userImg" class="w-8 h-8 rounded-full border" src="">
            <button id="logoutBtn" class="text-gray-500 text-xs underline">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </div>
</nav>

<main class="max-w-xl mx-auto p-4">
    <div id="post-box" class="hidden bg-white rounded-xl shadow p-4 mb-6 border border-gray-200">
        <textarea id="captionInput" placeholder="Neler oluyor? (AteÅŸle!)" class="w-full border-none focus:ring-0 text-lg resize-none" rows="3"></textarea>
        <input type="text" id="urlInput" placeholder="GÃ¶rsel URL (Ä°steÄŸe baÄŸlÄ±)" class="w-full mt-2 p-2 bg-gray-50 rounded border text-sm">
        <div class="flex justify-end mt-3 border-t pt-3">
            <button id="shareBtn" class="bg-red-500 text-white px-6 py-2 rounded-full font-bold hover:bg-red-600">AteÅŸle</button>
        </div>
    </div>

    <div id="feed" class="space-y-4">
        <p class="text-center text-gray-400 py-10">YÃ¼kleniyor...</p>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc, arrayUnion, arrayRemove, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCTHfXRbJaUcN0ng-ik0B-N4Ai8pnnKiIk",
        authDomain: "rate-of-fire-rof.firebaseapp.com",
        projectId: "rate-of-fire-rof",
        storageBucket: "rate-of-fire-rof.firebasestorage.app",
        messagingSenderId: "706117316470",
        appId: "1:706117316470:web:833f1abf5994f96c0b5457"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // --- AUTH MANTIÄI ---
    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('auth-area').classList.add('hidden');
            document.getElementById('user-area').classList.remove('hidden');
            document.getElementById('post-box').classList.remove('hidden');
            document.getElementById('userImg').src = user.photoURL;
        } else {
            document.getElementById('auth-area').classList.remove('hidden');
            document.getElementById('user-area').classList.add('hidden');
            document.getElementById('post-box').classList.add('hidden');
        }
    });

    document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    // --- GÃ–NDERÄ° PAYLAÅMA ---
    document.getElementById('shareBtn').onclick = async () => {
        const user = auth.currentUser;
        const caption = document.getElementById('captionInput').value;
        const url = document.getElementById('urlInput').value;

        if (!caption && !url) return alert("BoÅŸ gÃ¶nderi atamazsÄ±n!");

        await addDoc(collection(db, "posts"), {
            uid: user.uid,
            userName: user.displayName,
            userPhoto: user.photoURL,
            caption: caption,
            imageUrl: url || null,
            likes: [], // BeÄŸenenlerin UID'leri burada tutulacak
            createdAt: serverTimestamp()
        });

        document.getElementById('captionInput').value = "";
        document.getElementById('urlInput').value = "";
    };

    // --- AKIÅI LÄ°STELEME VE BEÄENÄ° ---
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const id = docSnap.id;
            const isLiked = auth.currentUser && data.likes.includes(auth.currentUser.uid);

            const postHTML = `
                <div class="bg-white rounded-xl shadow border border-gray-100 overflow-hidden post-card">
                    <div class="p-3 flex items-center gap-2">
                        <img src="${data.userPhoto}" class="w-8 h-8 rounded-full border">
                        <span class="font-bold text-sm">${data.userName}</span>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="w-full max-h-96 object-cover border-y">` : ''}
                    <div class="p-4">
                        <p class="text-gray-800 mb-3">${data.caption}</p>
                        <div class="flex items-center gap-4">
                            <button onclick="handleLike('${id}', ${isLiked})" class="flex items-center gap-1 ${isLiked ? 'text-red-500' : 'text-gray-500'}">
                                <span>${isLiked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                                <span class="text-sm font-bold">${data.likes.length}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            feed.innerHTML += postHTML;
        });
    });

    // BEÄENÄ° FONKSÄ°YONU
    window.handleLike = async (postId, currentlyLiked) => {
        const user = auth.currentUser;
        if (!user) return alert("BeÄŸenmek iÃ§in giriÅŸ yapmalÄ±sÄ±n!");
        
        const postRef = doc(db, "posts", postId);
        await updateDoc(postRef, {
            likes: currentlyLiked ? arrayRemove(user.uid) : arrayUnion(user.uid)
        });
    };
</script>
</body>
</html>

